{"version":3,"file":"jquery.repeater.js","sources":["src/lib.js","src/main.js"],"sourcesContent":["/* eslint-disable no-param-reassign */\r\nimport $ from 'jquery';\r\n\r\nexport function identity(x) {\r\n\treturn x;\r\n}\r\n\r\nexport function isArray(value) {\r\n\treturn $.isArray(value);\r\n}\r\n\r\nexport function isObject(value) {\r\n\treturn !isArray(value) && (value instanceof Object);\r\n}\r\n\r\nexport function isNumber(value) {\r\n\treturn value instanceof Number;\r\n}\r\n\r\nexport function isFunction(value) {\r\n\treturn value instanceof Function;\r\n}\r\n\r\nexport function indexOf(object, value) {\r\n\treturn $.inArray(value, object);\r\n}\r\n\r\nexport function inArray(array, value) {\r\n\treturn indexOf(array, value) !== -1;\r\n}\r\n\r\nexport function foreach(collection, callback) {\r\n\tif (collection) {\r\n\t\tObject.keys(collection)\r\n\t\t\t.forEach(i => callback(collection[i], i, collection));\r\n\t}\r\n}\r\n\r\n\r\nexport function last(array) {\r\n\treturn array[array.length - 1];\r\n}\r\n\r\nexport function argumentsToArray(args) {\r\n\treturn Array.prototype.slice.call(args);\r\n}\r\n\r\nexport function extend(...args) {\r\n\tconst extended = {};\r\n\tforeach(args, (o) => {\r\n\t\tforeach(o, (val, key) => {\r\n\t\t\textended[key] = val;\r\n\t\t});\r\n\t});\r\n\treturn extended;\r\n}\r\n\r\nexport function mapToArray(collection, callback) {\r\n\tconst mapped = [];\r\n\tforeach(collection, (value, key, coll) => {\r\n\t\tmapped.push(callback(value, key, coll));\r\n\t});\r\n\treturn mapped;\r\n}\r\n\r\nexport function mapToObject(collection, callback, keyCallback) {\r\n\tconst mapped = {};\r\n\tforeach(collection, (value, key, coll) => {\r\n\t\t// eslint-disable-next-line no-param-reassign\r\n\t\tkey = keyCallback ? keyCallback(key, value) : key;\r\n\t\tmapped[key] = callback(value, key, coll);\r\n\t});\r\n\treturn mapped;\r\n}\r\n\r\nexport function map(collection, callback, keyCallback) {\r\n\treturn isArray(collection)\r\n\t\t? mapToArray(collection, callback)\r\n\t\t: mapToObject(collection, callback, keyCallback);\r\n}\r\n\r\nexport function pluck(arrayOfObjects, key) {\r\n\treturn map(arrayOfObjects, val => val[key]);\r\n}\r\n\r\nexport function filter(collection, callback) {\r\n\tlet filtered;\r\n\r\n\tif (isArray(collection)) {\r\n\t\tfiltered = [];\r\n\t\tforeach(collection, (val, key, coll) => {\r\n\t\t\tif (callback(val, key, coll)) {\r\n\t\t\t\tfiltered.push(val);\r\n\t\t\t}\r\n\t\t});\r\n\t} else {\r\n\t\tfiltered = {};\r\n\t\tforeach(collection, (val, key, coll) => {\r\n\t\t\tif (callback(val, key, coll)) {\r\n\t\t\t\tfiltered[key] = val;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treturn filtered;\r\n}\r\n\r\nexport function call(collection, funcName, args) {\r\n\treturn map(collection, (object, _) => object[funcName](...(args || [])));\r\n}\r\n\r\n// execute callback immediately and at most one time on the minimumInterval,\r\n// ignore block attempts\r\nexport function throttle(minimumInterval, callback) {\r\n\tlet timeout = null;\r\n\treturn function (...args) {\r\n\t\tconst that = this;\r\n\t\tif (timeout === null) {\r\n\t\t\ttimeout = setTimeout(() => {\r\n\t\t\t\ttimeout = null;\r\n\t\t\t}, minimumInterval);\r\n\t\t\tcallback.apply(that, args);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n\r\nexport function mixinPubSub(object) {\r\n\tobject = object || {};\r\n\tconst topics = {};\r\n\r\n\tobject.publish = function (topic, data) {\r\n\t\tforeach(topics[topic], (callback) => {\r\n\t\t\tcallback(data);\r\n\t\t});\r\n\t};\r\n\r\n\tobject.subscribe = function (topic, callback) {\r\n\t\ttopics[topic] = topics[topic] || [];\r\n\t\ttopics[topic].push(callback);\r\n\t};\r\n\r\n\tobject.unsubscribe = function (callback) {\r\n\t\tforeach(topics, (subscribers) => {\r\n\t\t\tconst index = indexOf(subscribers, callback);\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tsubscribers.splice(index, 1);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\treturn object;\r\n}\r\n","import $ from 'jquery';\r\nimport {\r\n\tpluck, foreach, map, extend, last, filter, identity,\r\n} from './lib';\r\n\r\n$.fn.repeaterVal = function () {\r\n\tconst parse = function (raw) {\r\n\t\tconst parsed = [];\r\n\r\n\t\tforeach(raw, (val, key) => {\r\n\t\t\tlet parsedKey = [];\r\n\t\t\tif (key !== 'undefined') {\r\n\t\t\t\tparsedKey.push(key.match(/^[^[]*/)[0]);\r\n\t\t\t\tparsedKey = parsedKey.concat(map(\r\n\t\t\t\t\tkey.match(/\\[[^\\]]*\\]/g),\r\n\t\t\t\t\tbracketed => bracketed.replace(/[[\\]]/g, ''),\r\n\t\t\t\t));\r\n\r\n\t\t\t\tparsed.push({\r\n\t\t\t\t\tval,\r\n\t\t\t\t\tkey: parsedKey,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn parsed;\r\n\t};\r\n\r\n\tfunction build(parsed) {\r\n\t\tif (\r\n\t\t\tparsed.length === 1\r\n\t\t\t\t&&\t(parsed[0].key.length === 0 || parsed[0].key.length === 1)\r\n\t\t\t\t&& !parsed[0].key[0]\r\n\t\t) {\r\n\t\t\treturn parsed[0].val;\r\n\t\t}\r\n\r\n\t\tforeach(parsed, (p) => {\r\n\t\t\t// eslint-disable-next-line no-param-reassign\r\n\t\t\tp.head = p.key.shift();\r\n\t\t});\r\n\r\n\t\tconst grouped = (function () {\r\n\t\t\tconst mGrouped = {};\r\n\r\n\t\t\tforeach(parsed, (p) => {\r\n\t\t\t\tif (!mGrouped[p.head]) {\r\n\t\t\t\t\tmGrouped[p.head] = [];\r\n\t\t\t\t}\r\n\t\t\t\tmGrouped[p.head].push(p);\r\n\t\t\t});\r\n\r\n\t\t\treturn mGrouped;\r\n\t\t}());\r\n\r\n\t\tlet built;\r\n\r\n\t\tif (/^[0-9]+$/.test(parsed[0].head)) {\r\n\t\t\tbuilt = [];\r\n\t\t\tforeach(grouped, (group) => {\r\n\t\t\t\tbuilt.push(build(group));\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tbuilt = {};\r\n\t\t\tforeach(grouped, (group, key) => {\r\n\t\t\t\tbuilt[key] = build(group);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn built;\r\n\t}\r\n\r\n\treturn build(parse($(this).inputVal()));\r\n};\r\n\r\n$.fn.repeater = function (fig) {\r\n\t// eslint-disable-next-line no-param-reassign\r\n\tfig = fig || {};\r\n\r\n\tlet setList;\r\n\r\n\t$(this).each(function () {\r\n\t\tconst $self = $(this);\r\n\r\n\t\tconst show = fig.show || function () {\r\n\t\t\t$(this).show();\r\n\t\t};\r\n\r\n\t\tconst hide = fig.hide || function (removeElement) {\r\n\t\t\tremoveElement();\r\n\t\t};\r\n\r\n\t\tconst $list = $self.find('[data-repeater-list]').first();\r\n\r\n\t\tconst $filterNested = function ($items, repeaters) {\r\n\t\t\treturn $items.filter(function () {\r\n\t\t\t\treturn repeaters\r\n\t\t\t\t\t? $(this).closest(\r\n\t\t\t\t\t\tpluck(repeaters, 'selector').join(','),\r\n\t\t\t\t\t).length === 0 : true;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tconst $items = function () {\r\n\t\t\treturn $filterNested($list.find('[data-repeater-item]'), fig.repeaters);\r\n\t\t};\r\n\r\n\t\tconst $itemTemplate = $list.find('[data-repeater-item]')\r\n\t\t\t.first().clone().hide();\r\n\r\n\t\tconst $firstDeleteButton = $filterNested(\r\n\t\t\t$filterNested($(this).find('[data-repeater-item]'), fig.repeaters)\r\n\t\t\t\t.first().find('[data-repeater-delete]'),\r\n\t\t\tfig.repeaters,\r\n\t\t);\r\n\r\n\t\tif (fig.isFirstItemUndeletable && $firstDeleteButton) {\r\n\t\t\t$firstDeleteButton.remove();\r\n\t\t}\r\n\r\n\t\tconst getGroupName = function () {\r\n\t\t\tconst groupName = $list.data('repeater-list');\r\n\t\t\treturn fig.$parent\r\n\t\t\t\t? `${fig.$parent.data('item-name')}[${groupName}]`\r\n\t\t\t\t: groupName;\r\n\t\t};\r\n\r\n\t\tconst initNested = function ($listItems) {\r\n\t\t\tif (fig.repeaters) {\r\n\t\t\t\t$listItems.each(function () {\r\n\t\t\t\t\tconst $item = $(this);\r\n\t\t\t\t\tforeach(fig.repeaters, (nestedFig) => {\r\n\t\t\t\t\t\t$item.find(nestedFig.selector).repeater(extend(\r\n\t\t\t\t\t\t\tnestedFig, { $parent: $item },\r\n\t\t\t\t\t\t));\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tconst $foreachRepeaterInItem = function (repeaters, $item, cb) {\r\n\t\t\tif (repeaters) {\r\n\t\t\t\tforeach(repeaters, (nestedFig) => {\r\n\t\t\t\t\tcb.call($item.find(nestedFig.selector)[0], nestedFig);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfunction setIndexes($its, groupName, repeaters) {\r\n\t\t\t$its.each(function (index) {\r\n\t\t\t\tconst $item = $(this);\r\n\t\t\t\t$item.data('item-name', `${groupName}[${index}]`);\r\n\t\t\t\t$filterNested($item.find('[name]'), repeaters)\r\n\t\t\t\t\t.each(function () {\r\n\t\t\t\t\t\tconst $input = $(this);\r\n\t\t\t\t\t\t// match non empty brackets (ex: \"[foo]\")\r\n\t\t\t\t\t\tconst matches = $input.attr('name').match(/\\[[^\\]]+\\]/g);\r\n\r\n\t\t\t\t\t\tconst name = matches\r\n\t\t\t\t\t\t// strip \"[\" and \"]\" characters\r\n\t\t\t\t\t\t\t? last(matches).replace(/\\[|\\]/g, '')\r\n\t\t\t\t\t\t\t: $input.attr('name');\r\n\r\n\r\n\t\t\t\t\t\tconst newName = `${groupName}[${index}][${name}]${\r\n\t\t\t\t\t\t\t$input.is(':checkbox') || $input.attr('multiple') ? '[]' : ''}`;\r\n\r\n\t\t\t\t\t\t$input.attr('name', newName);\r\n\r\n\t\t\t\t\t\t$foreachRepeaterInItem(repeaters, $item, function (nestedFig) {\r\n\t\t\t\t\t\t\tconst $repeater = $(this);\r\n\t\t\t\t\t\t\tsetIndexes(\r\n\t\t\t\t\t\t\t\t$filterNested($repeater.find('[data-repeater-item]'), nestedFig.repeaters || []),\r\n\t\t\t\t\t\t\t\t`${groupName}[${index}]`\r\n\t\t\t\t\t\t\t\t\t\t+ `[${$repeater.find('[data-repeater-list]').first().data('repeater-list')}]`,\r\n\t\t\t\t\t\t\t\tnestedFig.repeaters,\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t$list.find('input[name][checked]')\r\n\t\t\t\t.removeAttr('checked')\r\n\t\t\t\t.prop('checked', true);\r\n\t\t}\r\n\r\n\t\tsetIndexes($items(), getGroupName(), fig.repeaters);\r\n\t\tinitNested($items());\r\n\t\tif (fig.initEmpty) {\r\n\t\t\t$items().remove();\r\n\t\t}\r\n\r\n\t\tif (fig.ready) {\r\n\t\t\tfig.ready(() => {\r\n\t\t\t\tsetIndexes($items(), getGroupName(), fig.repeaters);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst appendItem = (function () {\r\n\t\t\tfunction setItemsValues($item, data, repeaters) {\r\n\t\t\t\tif (data || fig.defaultValues) {\r\n\t\t\t\t\tconst inputNames = {};\r\n\t\t\t\t\t$filterNested($item.find('[name]'), repeaters).each(function () {\r\n\t\t\t\t\t\tconst key = $(this).attr('name').match(/\\[([^\\]]*)(\\]|\\]\\[\\])$/)[1];\r\n\t\t\t\t\t\tinputNames[key] = $(this).attr('name');\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$item.inputVal(map(\r\n\t\t\t\t\t\tfilter(data || fig.defaultValues, (val, name) => inputNames[name]),\r\n\t\t\t\t\t\tidentity,\r\n\t\t\t\t\t\tname => inputNames[name],\r\n\t\t\t\t\t));\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\t$foreachRepeaterInItem(repeaters, $item, function (nestedFig) {\r\n\t\t\t\t\tconst $repeater = $(this);\r\n\t\t\t\t\t$filterNested(\r\n\t\t\t\t\t\t$repeater.find('[data-repeater-item]'),\r\n\t\t\t\t\t\tnestedFig.repeaters,\r\n\t\t\t\t\t)\r\n\t\t\t\t\t\t.each(function () {\r\n\t\t\t\t\t\t\tconst fieldName = $repeater.find('[data-repeater-list]').data('repeater-list');\r\n\t\t\t\t\t\t\tif (data && data[fieldName]) {\r\n\t\t\t\t\t\t\t\tconst $template = $(this).clone();\r\n\t\t\t\t\t\t\t\t$repeater.find('[data-repeater-item]').remove();\r\n\t\t\t\t\t\t\t\tforeach(data[fieldName], (d) => {\r\n\t\t\t\t\t\t\t\t\tconst $itm = $template.clone();\r\n\t\t\t\t\t\t\t\t\tsetItemsValues(\r\n\t\t\t\t\t\t\t\t\t\t$itm,\r\n\t\t\t\t\t\t\t\t\t\td,\r\n\t\t\t\t\t\t\t\t\t\tnestedFig.repeaters || [],\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t$repeater.find('[data-repeater-list]').append($itm);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tsetItemsValues(\r\n\t\t\t\t\t\t\t\t\t$(this),\r\n\t\t\t\t\t\t\t\t\tnestedFig.defaultValues,\r\n\t\t\t\t\t\t\t\t\tnestedFig.repeaters || [],\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn function ($item, data) {\r\n\t\t\t\t$list.append($item);\r\n\t\t\t\tsetIndexes($items(), getGroupName(), fig.repeaters);\r\n\t\t\t\t$item.find('[name]').each(function () {\r\n\t\t\t\t\t$(this).inputClear();\r\n\t\t\t\t});\r\n\t\t\t\tsetItemsValues($item, data || fig.defaultValues, fig.repeaters);\r\n\t\t\t};\r\n\t\t}());\r\n\r\n\t\tconst addItem = function (data) {\r\n\t\t\tconst $item = $itemTemplate.clone();\r\n\t\t\tappendItem($item, data);\r\n\t\t\tif (fig.repeaters) {\r\n\t\t\t\tinitNested($item);\r\n\t\t\t}\r\n\t\t\tshow.call($item.get(0));\r\n\t\t};\r\n\r\n\t\tsetList = function (rows) {\r\n\t\t\t$items().remove();\r\n\t\t\tforeach(rows, addItem);\r\n\t\t};\r\n\r\n\t\t$filterNested($self.find('[data-repeater-create]'), fig.repeaters)\r\n\t\t\t.click(() => {\r\n\t\t\t\taddItem();\r\n\t\t\t});\r\n\r\n\t\t$list.on('click', '[data-repeater-delete]', function () {\r\n\t\t\tconst self = $(this).closest('[data-repeater-item]').get(0);\r\n\t\t\thide.call(self, () => {\r\n\t\t\t\t$(self).remove();\r\n\t\t\t\tsetIndexes($items(), getGroupName(), fig.repeaters);\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n\r\n\tthis.setList = setList;\r\n\r\n\treturn this;\r\n};\r\n"],"names":["identity","x","isArray","value","$","foreach","collection","callback","Object","keys","forEach","i","last","array","length","extend","extended","args","o","val","key","mapToArray","mapped","coll","push","mapToObject","keyCallback","map","pluck","arrayOfObjects","filter","filtered","fn","repeaterVal","parse","raw","parsed","parsedKey","match","concat","bracketed","replace","build","p","head","shift","grouped","mGrouped","built","test","group","inputVal","repeater","fig","setList","each","$self","show","hide","removeElement","$list","find","first","$filterNested","$items","repeaters","closest","join","$itemTemplate","clone","$firstDeleteButton","isFirstItemUndeletable","remove","getGroupName","groupName","data","$parent","initNested","$listItems","$item","nestedFig","selector","$foreachRepeaterInItem","cb","call","setIndexes","$its","index","$input","matches","attr","name","newName","is","$repeater","removeAttr","prop","initEmpty","ready","appendItem","setItemsValues","defaultValues","inputNames","fieldName","$template","d","$itm","append","inputClear","addItem","get","rows","click","on","self"],"mappings":";;;;;;;;EAGO,SAASA,QAAT,CAAkBC,CAAlB,EAAqB;EAC3B,SAAOA,CAAP;EACA;AAED,EAAO,SAASC,OAAT,CAAiBC,KAAjB,EAAwB;EAC9B,SAAOC,CAAC,CAACF,OAAF,CAAUC,KAAV,CAAP;EACA;AAED,EAoBO,SAASE,OAAT,CAAiBC,UAAjB,EAA6BC,QAA7B,EAAuC;EAC7C,MAAID,UAAJ,EAAgB;EACfE,IAAAA,MAAM,CAACC,IAAP,CAAYH,UAAZ,EACEI,OADF,CACU,UAAAC,CAAC;EAAA,aAAIJ,QAAQ,CAACD,UAAU,CAACK,CAAD,CAAX,EAAgBA,CAAhB,EAAmBL,UAAnB,CAAZ;EAAA,KADX;EAEA;EACD;AAGD,EAAO,SAASM,IAAT,CAAcC,KAAd,EAAqB;EAC3B,SAAOA,KAAK,CAACA,KAAK,CAACC,MAAN,GAAe,CAAhB,CAAZ;EACA;AAED,EAIO,SAASC,MAAT,GAAyB;EAC/B,MAAMC,QAAQ,GAAG,EAAjB;;EAD+B,oCAANC,IAAM;EAANA,IAAAA,IAAM;EAAA;;EAE/BZ,EAAAA,OAAO,CAACY,IAAD,EAAO,UAACC,CAAD,EAAO;EACpBb,IAAAA,OAAO,CAACa,CAAD,EAAI,UAACC,GAAD,EAAMC,GAAN,EAAc;EACxBJ,MAAAA,QAAQ,CAACI,GAAD,CAAR,GAAgBD,GAAhB;EACA,KAFM,CAAP;EAGA,GAJM,CAAP;EAKA,SAAOH,QAAP;EACA;AAED,EAAO,SAASK,UAAT,CAAoBf,UAApB,EAAgCC,QAAhC,EAA0C;EAChD,MAAMe,MAAM,GAAG,EAAf;EACAjB,EAAAA,OAAO,CAACC,UAAD,EAAa,UAACH,KAAD,EAAQiB,GAAR,EAAaG,IAAb,EAAsB;EACzCD,IAAAA,MAAM,CAACE,IAAP,CAAYjB,QAAQ,CAACJ,KAAD,EAAQiB,GAAR,EAAaG,IAAb,CAApB;EACA,GAFM,CAAP;EAGA,SAAOD,MAAP;EACA;AAED,EAAO,SAASG,WAAT,CAAqBnB,UAArB,EAAiCC,QAAjC,EAA2CmB,WAA3C,EAAwD;EAC9D,MAAMJ,MAAM,GAAG,EAAf;EACAjB,EAAAA,OAAO,CAACC,UAAD,EAAa,UAACH,KAAD,EAAQiB,GAAR,EAAaG,IAAb,EAAsB;EACzC;EACAH,IAAAA,GAAG,GAAGM,WAAW,GAAGA,WAAW,CAACN,GAAD,EAAMjB,KAAN,CAAd,GAA6BiB,GAA9C;EACAE,IAAAA,MAAM,CAACF,GAAD,CAAN,GAAcb,QAAQ,CAACJ,KAAD,EAAQiB,GAAR,EAAaG,IAAb,CAAtB;EACA,GAJM,CAAP;EAKA,SAAOD,MAAP;EACA;AAED,EAAO,SAASK,GAAT,CAAarB,UAAb,EAAyBC,QAAzB,EAAmCmB,WAAnC,EAAgD;EACtD,SAAOxB,OAAO,CAACI,UAAD,CAAP,GACJe,UAAU,CAACf,UAAD,EAAaC,QAAb,CADN,GAEJkB,WAAW,CAACnB,UAAD,EAAaC,QAAb,EAAuBmB,WAAvB,CAFd;EAGA;AAED,EAAO,SAASE,KAAT,CAAeC,cAAf,EAA+BT,GAA/B,EAAoC;EAC1C,SAAOO,GAAG,CAACE,cAAD,EAAiB,UAAAV,GAAG;EAAA,WAAIA,GAAG,CAACC,GAAD,CAAP;EAAA,GAApB,CAAV;EACA;AAED,EAAO,SAASU,MAAT,CAAgBxB,UAAhB,EAA4BC,QAA5B,EAAsC;EAC5C,MAAIwB,QAAJ;;EAEA,MAAI7B,OAAO,CAACI,UAAD,CAAX,EAAyB;EACxByB,IAAAA,QAAQ,GAAG,EAAX;EACA1B,IAAAA,OAAO,CAACC,UAAD,EAAa,UAACa,GAAD,EAAMC,GAAN,EAAWG,IAAX,EAAoB;EACvC,UAAIhB,QAAQ,CAACY,GAAD,EAAMC,GAAN,EAAWG,IAAX,CAAZ,EAA8B;EAC7BQ,QAAAA,QAAQ,CAACP,IAAT,CAAcL,GAAd;EACA;EACD,KAJM,CAAP;EAKA,GAPD,MAOO;EACNY,IAAAA,QAAQ,GAAG,EAAX;EACA1B,IAAAA,OAAO,CAACC,UAAD,EAAa,UAACa,GAAD,EAAMC,GAAN,EAAWG,IAAX,EAAoB;EACvC,UAAIhB,QAAQ,CAACY,GAAD,EAAMC,GAAN,EAAWG,IAAX,CAAZ,EAA8B;EAC7BQ,QAAAA,QAAQ,CAACX,GAAD,CAAR,GAAgBD,GAAhB;EACA;EACD,KAJM,CAAP;EAKA;;EAED,SAAOY,QAAP;EACA;;ECpGD3B,CAAC,CAAC4B,EAAF,CAAKC,WAAL,GAAmB,YAAY;EAC9B,MAAMC,KAAK,GAAG,SAARA,KAAQ,CAAUC,GAAV,EAAe;EAC5B,QAAMC,MAAM,GAAG,EAAf;EAEA/B,IAAAA,OAAO,CAAC8B,GAAD,EAAM,UAAChB,GAAD,EAAMC,GAAN,EAAc;EAC1B,UAAIiB,SAAS,GAAG,EAAhB;;EACA,UAAIjB,GAAG,KAAK,WAAZ,EAAyB;EACxBiB,QAAAA,SAAS,CAACb,IAAV,CAAeJ,GAAG,CAACkB,KAAJ,CAAU,QAAV,EAAoB,CAApB,CAAf;EACAD,QAAAA,SAAS,GAAGA,SAAS,CAACE,MAAV,CAAiBZ,GAAG,CAC/BP,GAAG,CAACkB,KAAJ,CAAU,aAAV,CAD+B,EAE/B,UAAAE,SAAS;EAAA,iBAAIA,SAAS,CAACC,OAAV,CAAkB,QAAlB,EAA4B,EAA5B,CAAJ;EAAA,SAFsB,CAApB,CAAZ;EAKAL,QAAAA,MAAM,CAACZ,IAAP,CAAY;EACXL,UAAAA,GAAG,EAAHA,GADW;EAEXC,UAAAA,GAAG,EAAEiB;EAFM,SAAZ;EAIA;EACD,KAdM,CAAP;EAgBA,WAAOD,MAAP;EACA,GApBD;;EAsBA,WAASM,KAAT,CAAeN,MAAf,EAAuB;EACtB,QACCA,MAAM,CAACtB,MAAP,KAAkB,CAAlB,KACKsB,MAAM,CAAC,CAAD,CAAN,CAAUhB,GAAV,CAAcN,MAAd,KAAyB,CAAzB,IAA8BsB,MAAM,CAAC,CAAD,CAAN,CAAUhB,GAAV,CAAcN,MAAd,KAAyB,CAD5D,KAEI,CAACsB,MAAM,CAAC,CAAD,CAAN,CAAUhB,GAAV,CAAc,CAAd,CAHN,EAIE;EACD,aAAOgB,MAAM,CAAC,CAAD,CAAN,CAAUjB,GAAjB;EACA;;EAEDd,IAAAA,OAAO,CAAC+B,MAAD,EAAS,UAACO,CAAD,EAAO;EACtB;EACAA,MAAAA,CAAC,CAACC,IAAF,GAASD,CAAC,CAACvB,GAAF,CAAMyB,KAAN,EAAT;EACA,KAHM,CAAP;;EAKA,QAAMC,OAAO,GAAI,YAAY;EAC5B,UAAMC,QAAQ,GAAG,EAAjB;EAEA1C,MAAAA,OAAO,CAAC+B,MAAD,EAAS,UAACO,CAAD,EAAO;EACtB,YAAI,CAACI,QAAQ,CAACJ,CAAC,CAACC,IAAH,CAAb,EAAuB;EACtBG,UAAAA,QAAQ,CAACJ,CAAC,CAACC,IAAH,CAAR,GAAmB,EAAnB;EACA;;EACDG,QAAAA,QAAQ,CAACJ,CAAC,CAACC,IAAH,CAAR,CAAiBpB,IAAjB,CAAsBmB,CAAtB;EACA,OALM,CAAP;EAOA,aAAOI,QAAP;EACA,KAXgB,EAAjB;;EAaA,QAAIC,KAAJ;;EAEA,QAAI,WAAWC,IAAX,CAAgBb,MAAM,CAAC,CAAD,CAAN,CAAUQ,IAA1B,CAAJ,EAAqC;EACpCI,MAAAA,KAAK,GAAG,EAAR;EACA3C,MAAAA,OAAO,CAACyC,OAAD,EAAU,UAACI,KAAD,EAAW;EAC3BF,QAAAA,KAAK,CAACxB,IAAN,CAAWkB,KAAK,CAACQ,KAAD,CAAhB;EACA,OAFM,CAAP;EAGA,KALD,MAKO;EACNF,MAAAA,KAAK,GAAG,EAAR;EACA3C,MAAAA,OAAO,CAACyC,OAAD,EAAU,UAACI,KAAD,EAAQ9B,GAAR,EAAgB;EAChC4B,QAAAA,KAAK,CAAC5B,GAAD,CAAL,GAAasB,KAAK,CAACQ,KAAD,CAAlB;EACA,OAFM,CAAP;EAGA;;EAED,WAAOF,KAAP;EACA;;EAED,SAAON,KAAK,CAACR,KAAK,CAAC9B,CAAC,CAAC,IAAD,CAAD,CAAQ+C,QAAR,EAAD,CAAN,CAAZ;EACA,CApED;;EAsEA/C,CAAC,CAAC4B,EAAF,CAAKoB,QAAL,GAAgB,UAAUC,GAAV,EAAe;EAC9B;EACAA,EAAAA,GAAG,GAAGA,GAAG,IAAI,EAAb;EAEA,MAAIC,OAAJ;EAEAlD,EAAAA,CAAC,CAAC,IAAD,CAAD,CAAQmD,IAAR,CAAa,YAAY;EACxB,QAAMC,KAAK,GAAGpD,CAAC,CAAC,IAAD,CAAf;;EAEA,QAAMqD,IAAI,GAAGJ,GAAG,CAACI,IAAJ,IAAY,YAAY;EACpCrD,MAAAA,CAAC,CAAC,IAAD,CAAD,CAAQqD,IAAR;EACA,KAFD;;EAIA,QAAMC,IAAI,GAAGL,GAAG,CAACK,IAAJ,IAAY,UAAUC,aAAV,EAAyB;EACjDA,MAAAA,aAAa;EACb,KAFD;;EAIA,QAAMC,KAAK,GAAGJ,KAAK,CAACK,IAAN,CAAW,sBAAX,EAAmCC,KAAnC,EAAd;;EAEA,QAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAAUC,MAAV,EAAkBC,SAAlB,EAA6B;EAClD,aAAOD,MAAM,CAAClC,MAAP,CAAc,YAAY;EAChC,eAAOmC,SAAS,GACb7D,CAAC,CAAC,IAAD,CAAD,CAAQ8D,OAAR,CACDtC,KAAK,CAACqC,SAAD,EAAY,UAAZ,CAAL,CAA6BE,IAA7B,CAAkC,GAAlC,CADC,EAEArD,MAFA,KAEW,CAHE,GAGE,IAHlB;EAIA,OALM,CAAP;EAMA,KAPD;;EASA,QAAMkD,MAAM,GAAG,SAATA,MAAS,GAAY;EAC1B,aAAOD,aAAa,CAACH,KAAK,CAACC,IAAN,CAAW,sBAAX,CAAD,EAAqCR,GAAG,CAACY,SAAzC,CAApB;EACA,KAFD;;EAIA,QAAMG,aAAa,GAAGR,KAAK,CAACC,IAAN,CAAW,sBAAX,EACpBC,KADoB,GACZO,KADY,GACJX,IADI,EAAtB;EAGA,QAAMY,kBAAkB,GAAGP,aAAa,CACvCA,aAAa,CAAC3D,CAAC,CAAC,IAAD,CAAD,CAAQyD,IAAR,CAAa,sBAAb,CAAD,EAAuCR,GAAG,CAACY,SAA3C,CAAb,CACEH,KADF,GACUD,IADV,CACe,wBADf,CADuC,EAGvCR,GAAG,CAACY,SAHmC,CAAxC;;EAMA,QAAIZ,GAAG,CAACkB,sBAAJ,IAA8BD,kBAAlC,EAAsD;EACrDA,MAAAA,kBAAkB,CAACE,MAAnB;EACA;;EAED,QAAMC,YAAY,GAAG,SAAfA,YAAe,GAAY;EAChC,UAAMC,SAAS,GAAGd,KAAK,CAACe,IAAN,CAAW,eAAX,CAAlB;EACA,aAAOtB,GAAG,CAACuB,OAAJ,aACDvB,GAAG,CAACuB,OAAJ,CAAYD,IAAZ,CAAiB,WAAjB,CADC,cACgCD,SADhC,SAEJA,SAFH;EAGA,KALD;;EAOA,QAAMG,UAAU,GAAG,SAAbA,UAAa,CAAUC,UAAV,EAAsB;EACxC,UAAIzB,GAAG,CAACY,SAAR,EAAmB;EAClBa,QAAAA,UAAU,CAACvB,IAAX,CAAgB,YAAY;EAC3B,cAAMwB,KAAK,GAAG3E,CAAC,CAAC,IAAD,CAAf;EACAC,UAAAA,OAAO,CAACgD,GAAG,CAACY,SAAL,EAAgB,UAACe,SAAD,EAAe;EACrCD,YAAAA,KAAK,CAAClB,IAAN,CAAWmB,SAAS,CAACC,QAArB,EAA+B7B,QAA/B,CAAwCrC,MAAM,CAC7CiE,SAD6C,EAClC;EAAEJ,cAAAA,OAAO,EAAEG;EAAX,aADkC,CAA9C;EAGA,WAJM,CAAP;EAKA,SAPD;EAQA;EACD,KAXD;;EAaA,QAAMG,sBAAsB,GAAG,SAAzBA,sBAAyB,CAAUjB,SAAV,EAAqBc,KAArB,EAA4BI,EAA5B,EAAgC;EAC9D,UAAIlB,SAAJ,EAAe;EACd5D,QAAAA,OAAO,CAAC4D,SAAD,EAAY,UAACe,SAAD,EAAe;EACjCG,UAAAA,EAAE,CAACC,IAAH,CAAQL,KAAK,CAAClB,IAAN,CAAWmB,SAAS,CAACC,QAArB,EAA+B,CAA/B,CAAR,EAA2CD,SAA3C;EACA,SAFM,CAAP;EAGA;EACD,KAND;;EAQA,aAASK,UAAT,CAAoBC,IAApB,EAA0BZ,SAA1B,EAAqCT,SAArC,EAAgD;EAC/CqB,MAAAA,IAAI,CAAC/B,IAAL,CAAU,UAAUgC,KAAV,EAAiB;EAC1B,YAAMR,KAAK,GAAG3E,CAAC,CAAC,IAAD,CAAf;EACA2E,QAAAA,KAAK,CAACJ,IAAN,CAAW,WAAX,YAA2BD,SAA3B,cAAwCa,KAAxC;EACAxB,QAAAA,aAAa,CAACgB,KAAK,CAAClB,IAAN,CAAW,QAAX,CAAD,EAAuBI,SAAvB,CAAb,CACEV,IADF,CACO,YAAY;EACjB,cAAMiC,MAAM,GAAGpF,CAAC,CAAC,IAAD,CAAhB,CADiB;;EAGjB,cAAMqF,OAAO,GAAGD,MAAM,CAACE,IAAP,CAAY,MAAZ,EAAoBpD,KAApB,CAA0B,aAA1B,CAAhB;EAEA,cAAMqD,IAAI,GAAGF,OAAO;EAAA,YAEjB7E,IAAI,CAAC6E,OAAD,CAAJ,CAAchD,OAAd,CAAsB,QAAtB,EAAgC,EAAhC,CAFiB,GAGjB+C,MAAM,CAACE,IAAP,CAAY,MAAZ,CAHH;EAMA,cAAME,OAAO,aAAMlB,SAAN,cAAmBa,KAAnB,eAA6BI,IAA7B,cACZH,MAAM,CAACK,EAAP,CAAU,WAAV,KAA0BL,MAAM,CAACE,IAAP,CAAY,UAAZ,CAA1B,GAAoD,IAApD,GAA2D,EAD/C,CAAb;EAGAF,UAAAA,MAAM,CAACE,IAAP,CAAY,MAAZ,EAAoBE,OAApB;EAEAV,UAAAA,sBAAsB,CAACjB,SAAD,EAAYc,KAAZ,EAAmB,UAAUC,SAAV,EAAqB;EAC7D,gBAAMc,SAAS,GAAG1F,CAAC,CAAC,IAAD,CAAnB;EACAiF,YAAAA,UAAU,CACTtB,aAAa,CAAC+B,SAAS,CAACjC,IAAV,CAAe,sBAAf,CAAD,EAAyCmB,SAAS,CAACf,SAAV,IAAuB,EAAhE,CADJ,EAET,UAAGS,SAAH,cAAgBa,KAAhB,oBACQO,SAAS,CAACjC,IAAV,CAAe,sBAAf,EAAuCC,KAAvC,GAA+Ca,IAA/C,CAAoD,eAApD,CADR,MAFS,EAITK,SAAS,CAACf,SAJD,CAAV;EAMA,WARqB,CAAtB;EASA,SA1BF;EA2BA,OA9BD;EAgCAL,MAAAA,KAAK,CAACC,IAAN,CAAW,sBAAX,EACEkC,UADF,CACa,SADb,EAEEC,IAFF,CAEO,SAFP,EAEkB,IAFlB;EAGA;;EAEDX,IAAAA,UAAU,CAACrB,MAAM,EAAP,EAAWS,YAAY,EAAvB,EAA2BpB,GAAG,CAACY,SAA/B,CAAV;EACAY,IAAAA,UAAU,CAACb,MAAM,EAAP,CAAV;;EACA,QAAIX,GAAG,CAAC4C,SAAR,EAAmB;EAClBjC,MAAAA,MAAM,GAAGQ,MAAT;EACA;;EAED,QAAInB,GAAG,CAAC6C,KAAR,EAAe;EACd7C,MAAAA,GAAG,CAAC6C,KAAJ,CAAU,YAAM;EACfb,QAAAA,UAAU,CAACrB,MAAM,EAAP,EAAWS,YAAY,EAAvB,EAA2BpB,GAAG,CAACY,SAA/B,CAAV;EACA,OAFD;EAGA;;EAED,QAAMkC,UAAU,GAAI,YAAY;EAC/B,eAASC,cAAT,CAAwBrB,KAAxB,EAA+BJ,IAA/B,EAAqCV,SAArC,EAAgD;EAC/C,YAAIU,IAAI,IAAItB,GAAG,CAACgD,aAAhB,EAA+B;EAC9B,cAAMC,UAAU,GAAG,EAAnB;EACAvC,UAAAA,aAAa,CAACgB,KAAK,CAAClB,IAAN,CAAW,QAAX,CAAD,EAAuBI,SAAvB,CAAb,CAA+CV,IAA/C,CAAoD,YAAY;EAC/D,gBAAMnC,GAAG,GAAGhB,CAAC,CAAC,IAAD,CAAD,CAAQsF,IAAR,CAAa,MAAb,EAAqBpD,KAArB,CAA2B,wBAA3B,EAAqD,CAArD,CAAZ;EACAgE,YAAAA,UAAU,CAAClF,GAAD,CAAV,GAAkBhB,CAAC,CAAC,IAAD,CAAD,CAAQsF,IAAR,CAAa,MAAb,CAAlB;EACA,WAHD;EAKAX,UAAAA,KAAK,CAAC5B,QAAN,CAAexB,GAAG,CACjBG,MAAM,CAAC6C,IAAI,IAAItB,GAAG,CAACgD,aAAb,EAA4B,UAAClF,GAAD,EAAMwE,IAAN;EAAA,mBAAeW,UAAU,CAACX,IAAD,CAAzB;EAAA,WAA5B,CADW,EAEjB3F,QAFiB,EAGjB,UAAA2F,IAAI;EAAA,mBAAIW,UAAU,CAACX,IAAD,CAAd;EAAA,WAHa,CAAlB;EAKA;;EAGDT,QAAAA,sBAAsB,CAACjB,SAAD,EAAYc,KAAZ,EAAmB,UAAUC,SAAV,EAAqB;EAC7D,cAAMc,SAAS,GAAG1F,CAAC,CAAC,IAAD,CAAnB;EACA2D,UAAAA,aAAa,CACZ+B,SAAS,CAACjC,IAAV,CAAe,sBAAf,CADY,EAEZmB,SAAS,CAACf,SAFE,CAAb,CAIEV,IAJF,CAIO,YAAY;EACjB,gBAAMgD,SAAS,GAAGT,SAAS,CAACjC,IAAV,CAAe,sBAAf,EAAuCc,IAAvC,CAA4C,eAA5C,CAAlB;;EACA,gBAAIA,IAAI,IAAIA,IAAI,CAAC4B,SAAD,CAAhB,EAA6B;EAC5B,kBAAMC,SAAS,GAAGpG,CAAC,CAAC,IAAD,CAAD,CAAQiE,KAAR,EAAlB;EACAyB,cAAAA,SAAS,CAACjC,IAAV,CAAe,sBAAf,EAAuCW,MAAvC;EACAnE,cAAAA,OAAO,CAACsE,IAAI,CAAC4B,SAAD,CAAL,EAAkB,UAACE,CAAD,EAAO;EAC/B,oBAAMC,IAAI,GAAGF,SAAS,CAACnC,KAAV,EAAb;EACA+B,gBAAAA,cAAc,CACbM,IADa,EAEbD,CAFa,EAGbzB,SAAS,CAACf,SAAV,IAAuB,EAHV,CAAd;EAKA6B,gBAAAA,SAAS,CAACjC,IAAV,CAAe,sBAAf,EAAuC8C,MAAvC,CAA8CD,IAA9C;EACA,eARM,CAAP;EASA,aAZD,MAYO;EACNN,cAAAA,cAAc,CACbhG,CAAC,CAAC,IAAD,CADY,EAEb4E,SAAS,CAACqB,aAFG,EAGbrB,SAAS,CAACf,SAAV,IAAuB,EAHV,CAAd;EAKA;EACD,WAzBF;EA0BA,SA5BqB,CAAtB;EA6BA;;EAED,aAAO,UAAUc,KAAV,EAAiBJ,IAAjB,EAAuB;EAC7Bf,QAAAA,KAAK,CAAC+C,MAAN,CAAa5B,KAAb;EACAM,QAAAA,UAAU,CAACrB,MAAM,EAAP,EAAWS,YAAY,EAAvB,EAA2BpB,GAAG,CAACY,SAA/B,CAAV;EACAc,QAAAA,KAAK,CAAClB,IAAN,CAAW,QAAX,EAAqBN,IAArB,CAA0B,YAAY;EACrCnD,UAAAA,CAAC,CAAC,IAAD,CAAD,CAAQwG,UAAR;EACA,SAFD;EAGAR,QAAAA,cAAc,CAACrB,KAAD,EAAQJ,IAAI,IAAItB,GAAG,CAACgD,aAApB,EAAmChD,GAAG,CAACY,SAAvC,CAAd;EACA,OAPD;EAQA,KAxDmB,EAApB;;EA0DA,QAAM4C,OAAO,GAAG,SAAVA,OAAU,CAAUlC,IAAV,EAAgB;EAC/B,UAAMI,KAAK,GAAGX,aAAa,CAACC,KAAd,EAAd;EACA8B,MAAAA,UAAU,CAACpB,KAAD,EAAQJ,IAAR,CAAV;;EACA,UAAItB,GAAG,CAACY,SAAR,EAAmB;EAClBY,QAAAA,UAAU,CAACE,KAAD,CAAV;EACA;;EACDtB,MAAAA,IAAI,CAAC2B,IAAL,CAAUL,KAAK,CAAC+B,GAAN,CAAU,CAAV,CAAV;EACA,KAPD;;EASAxD,IAAAA,OAAO,GAAG,iBAAUyD,IAAV,EAAgB;EACzB/C,MAAAA,MAAM,GAAGQ,MAAT;EACAnE,MAAAA,OAAO,CAAC0G,IAAD,EAAOF,OAAP,CAAP;EACA,KAHD;;EAKA9C,IAAAA,aAAa,CAACP,KAAK,CAACK,IAAN,CAAW,wBAAX,CAAD,EAAuCR,GAAG,CAACY,SAA3C,CAAb,CACE+C,KADF,CACQ,YAAM;EACZH,MAAAA,OAAO;EACP,KAHF;EAKAjD,IAAAA,KAAK,CAACqD,EAAN,CAAS,OAAT,EAAkB,wBAAlB,EAA4C,YAAY;EACvD,UAAMC,IAAI,GAAG9G,CAAC,CAAC,IAAD,CAAD,CAAQ8D,OAAR,CAAgB,sBAAhB,EAAwC4C,GAAxC,CAA4C,CAA5C,CAAb;EACApD,MAAAA,IAAI,CAAC0B,IAAL,CAAU8B,IAAV,EAAgB,YAAM;EACrB9G,QAAAA,CAAC,CAAC8G,IAAD,CAAD,CAAQ1C,MAAR;EACAa,QAAAA,UAAU,CAACrB,MAAM,EAAP,EAAWS,YAAY,EAAvB,EAA2BpB,GAAG,CAACY,SAA/B,CAAV;EACA,OAHD;EAIA,KAND;EAOA,GAzMD;EA2MA,OAAKX,OAAL,GAAeA,OAAf;EAEA,SAAO,IAAP;EACA,CApND;;;;"}